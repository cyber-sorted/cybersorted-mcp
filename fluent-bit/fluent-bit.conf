[SERVICE]
    Flush        5
    Daemon       Off
    Log_Level    info
    Parsers_File /fluent-bit/etc/parsers.conf

# Accept logs from Docker fluentd driver
[INPUT]
    Name         forward
    Listen       0.0.0.0
    Port         24224
    Tag          docker.*

# Parse JSON log lines from MCP server
[FILTER]
    Name         parser
    Match        docker.mcp-server*
    Key_Name     log
    Parser       json
    Reserve_Data On

# Parse nginx access logs
[FILTER]
    Name         parser
    Match        docker.nginx*
    Key_Name     log
    Parser       nginx
    Reserve_Data On

# Add resource labels
[FILTER]
    Name         modify
    Match        *
    Add          service mcp-server
    Add          environment prod

# Ship to GCP Cloud Logging
[OUTPUT]
    Name                 stackdriver
    Match                *
    google_service_credentials /fluent-bit/credentials/gcp-sa.json
    resource             generic_node
    location             uksouth
    namespace            cybersorted-mcp
    node_id              vm-mcp-prod
    Retry_Limit          5
